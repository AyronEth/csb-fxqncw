{"version":3,"sources":["ErrorMessage.js","store.js","SuccessMessage.js","SignMessage.js","App.js","index.js"],"names":["ErrorMessage","message","className","xmlns","fill","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","getFirestore","usersDb","collection","updatePendingTicket","ticketUuid","signature","a","getPendingTicket","document","signed_message","updated_doc","updateDoc","doc","getDoc","docVal","exists","data","deleteDoc","userName","onUserNameChangedListener","query","where","findUserQuery","onSnapshot","snapshot","docs","map","SuccessMessage","SignMessage","useState","error","setError","success","mainWallet","setMainWallet","mintWallet","setMintWallet","setTicketUuid","discordId","setDiscordId","useSearchParams","searchParams","provider","ethers","providers","Web3Provider","window","ethereum","signMessage","console","log","Error","send","signer","getSigner","getAddress","wallet","onMainWalletAssignment","e","preventDefault","updatedData","onMainWalletUnassignment","onMintWalletAssignment","onMintWalletUnassignment","useEffect","get","fetchDiscordId","pendingTicket","listenForAddressChange","docData","addEventListener","deleteTicket","class","onClick","disabled","type","App","rootElement","getElementById","ReactDOM","render"],"mappings":"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","file":"static/js/main.8b933ab8.chunk.js","sourcesContent":["export default function ErrorMessage({ message }) {\n  if (!message) return null;\n\n  return (\n    <div className=\"alert alert-error\">\n      <div className=\"flex-1\">\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          className=\"w-6 h-6 mx-2 stroke-current\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            strokeWidth=\"2\"\n            d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\"\n          ></path>\n        </svg>\n        <label>{message}</label>\n      </div>\n    </div>\n  );\n}\n","// Import the functions you need from the SDKs you need\r\nimport { initializeApp } from \"firebase/app\";\r\nimport {\r\n  getFirestore,\r\n  updateDoc,\r\n  query,\r\n  doc,\r\n  where,\r\n  collection,\r\n  onSnapshot,\r\n  getDoc,\r\n  deleteDoc\r\n} from \"firebase/firestore\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyDEE55Nf4CiqH0sAnozGEnIsWShSsmKaUg\",\r\n  authDomain: \"discord-wallet-auth.firebaseapp.com\",\r\n  projectId: \"discord-wallet-auth\",\r\n  storageBucket: \"discord-wallet-auth.appspot.com\",\r\n  messagingSenderId: \"21899065217\",\r\n  appId: \"1:21899065217:web:108b941a3ff3001aed5a80\",\r\n  measurementId: \"G-B1NXSG2T8R\"\r\n};\r\n\r\nconst app = initializeApp(firebaseConfig);\r\nconst db = getFirestore(app);\r\nconst DISCORD_USER = \"DiscordUser\";\r\nconst usersDb = collection(db, DISCORD_USER);\r\n\r\nexport async function updatePendingTicket(ticketUuid, signature, message) {\r\n  if (!(await getPendingTicket(ticketUuid))) return false;\r\n  if (!signature || !message) return false;\r\n  let document = {\r\n    signed_message: signature,\r\n    updated_doc: message\r\n  };\r\n  await updateDoc(doc(collection(db, \"PendingEntry\"), ticketUuid), document);\r\n  return true;\r\n}\r\n\r\nexport async function getPendingTicket(ticketUuid) {\r\n  if (!ticketUuid) return null;\r\n  var docVal = await getDoc(doc(collection(db, \"PendingEntry\"), ticketUuid));\r\n  return docVal.exists() ? docVal.data() : null;\r\n}\r\n\r\nexport async function deleteTicket(ticketUuid) {\r\n  if (!ticketUuid) return null;\r\n  await deleteDoc(doc(collection(db, \"PendingEntry\"), ticketUuid));\r\n}\r\n\r\nexport async function listenForAddressChange(\r\n  userName,\r\n  onUserNameChangedListener\r\n) {\r\n  if (userName == null) return null;\r\n  var findUserQuery = await query(usersDb, where(\"discordId\", \"==\", userName));\r\n  onSnapshot(findUserQuery, (snapshot) => {\r\n    snapshot.docs.map((doc) => {\r\n      onUserNameChangedListener(doc.data());\r\n    });\r\n  });\r\n}\r\n","export default function SuccessMessage({ message }) {\n  if (!message) return null;\n\n  return (\n    <div className=\"alert alert-success\">\n      <div className=\"flex-1\">\n        <label>{message}</label>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from \"react\";\nimport { useSearchParams } from \"react-router-dom\";\nimport { ethers } from \"ethers\";\nimport ErrorMessage from \"./ErrorMessage\";\nimport {\n  updatePendingTicket,\n  listenForAddressChange,\n  getPendingTicket,\n  deleteTicket\n} from \"./store.js\";\nimport SuccessMessage from \"./SuccessMessage\";\nimport { deleteDoc } from \"firebase/firestore\";\n\nexport default function SignMessage() {\n  const [error, setError] = useState();\n  const [success, setSuccess] = useState();\n  const [mainWallet, setMainWallet] = useState();\n  const [mintWallet, setMintWallet] = useState();\n  const [ticketUuid, setTicketUuid] = useState(\"\");\n  const [discordId, setDiscordId] = useState();\n  const [searchParams] = useSearchParams();\n  const provider = new ethers.providers.Web3Provider(window.ethereum);\n\n  const signMessage = async (ticketUuid) => {\n    let message = `\n  Click to sign in and verify your wallet with the 888 inner circle discord. \n\n  This request will not trigger a blockchain transaction or cost any gas fees.\n  `;\n    console.log({ message });\n    if (!window.ethereum)\n      throw new Error(\"No crypto wallet found. Please install it.\");\n\n    try {\n      await window.ethereum.send(\"eth_requestAccounts\");\n      const signer = provider.getSigner();\n      const wallet = await signer.getAddress();\n      message += `\\n Signing wallet:  ${wallet}`;\n      message += `\\n Nonce:  ${ticketUuid}`;\n      const signature = await signer.signMessage(message);\n\n      return {\n        message: message,\n        signature: signature,\n        wallet: wallet\n      };\n    } catch (err) {\n      setError(\"Failed to sign message. \" + err.message);\n      return null;\n    }\n  };\n\n  const onMainWalletAssignment = async (e) => {\n    e.preventDefault();\n    setError();\n    const signature = await signMessage(ticketUuid);\n    if (!signature) return;\n    var updatedData = {\n      wallet: signature.wallet\n    };\n    if (!(await updatePendingTicket(ticketUuid, signature, updatedData))) {\n      setError(\"Failed to update ticket.\");\n    }\n  };\n\n  const onMainWalletUnassignment = async (e) => {\n    e.preventDefault();\n    setError();\n    const signature = await signMessage(ticketUuid);\n    if (!signature) return;\n    var updatedData = {\n      wallet: null\n    };\n    if (!(await updatePendingTicket(ticketUuid, signature, updatedData))) {\n      setError(\"Failed to update ticket.\");\n    }\n  };\n\n  const onMintWalletAssignment = async (e) => {\n    e.preventDefault();\n    setError();\n    const signature = await signMessage(ticketUuid);\n    if (!signature) return;\n    var updatedData = {\n      mintWallet: signature.wallet\n    };\n    if (!(await updatePendingTicket(ticketUuid, signature, updatedData))) {\n      setError(\"Failed to update ticket.\");\n    }\n  };\n\n  const onMintWalletUnassignment = async (e) => {\n    e.preventDefault();\n    setError();\n    const signature = await signMessage(ticketUuid);\n    if (!signature) return;\n    var updatedData = {\n      mintWallet: null\n    };\n    if (!(await updatePendingTicket(ticketUuid, signature, updatedData))) {\n      setError(\"Failed to update ticket.\");\n    }\n  };\n\n  useEffect(() => {\n    setTicketUuid(searchParams.get(\"uuid\"));\n    console.log(ticketUuid);\n    if (ticketUuid == null) {\n      setError(\"Invalid Url. Please generate another link.\");\n      return;\n    }\n\n    const fetchDiscordId = async () => {\n      if (!ticketUuid) {\n        return;\n      }\n      var pendingTicket = await getPendingTicket(ticketUuid);\n      if (pendingTicket) {\n        setDiscordId(pendingTicket.discordId);\n      } else {\n        setError(\"Ticket not found. Please generate another link.\");\n      }\n    };\n    fetchDiscordId();\n\n    listenForAddressChange(discordId, (docData) => {\n      if (!docData) return;\n      setMainWallet(docData.wallet);\n      setMintWallet(docData.mintWallet);\n    });\n\n    window.addEventListener(\"beforeunload\", function (e) {\n      deleteTicket(ticketUuid);\n    });\n  }, [ticketUuid, searchParams, discordId]);\n\n  return (\n    <form className=\"m-4\">\n      <div className=\"credit-card w-full shadow-lg mx-auto rounded-xl bg-white\">\n        <main className=\"mt-4 p-4 space-y-4\">\n          <h1 className=\"text-xl font-semibold text-gray-700\">Discord Id:</h1>\n          {discordId ? (\n            <span class=\"badge badge-lg\">{discordId}</span>\n          ) : (\n            <ErrorMessage message=\"Discord id not found\" />\n          )}\n          <h1 className=\"text-xl font-semibold text-gray-700\">\n            Main (raffling) wallet:\n          </h1>\n          {mainWallet ? (\n            <button onClick={onMainWalletUnassignment}>\n              <div class=\"badge badge-lg badge-success gap-2\">\n                {mainWallet}\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  class=\"inline-block w-4 h-4 stroke-current\"\n                >\n                  <path\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                    stroke-width=\"2\"\n                    d=\"M6 18L18 6M6 6l12 12\"\n                  ></path>\n                </svg>\n              </div>\n            </button>\n          ) : (\n            <button\n              disabled={!discordId}\n              type=\"submit\"\n              onClick={onMainWalletAssignment}\n              className=\"btn btn-primary submit-button focus:ring focus:outline-none w-full\"\n            >\n              Sign and Verify wallet\n            </button>\n          )}\n          <div>\n            <h1 className=\"text-xl font-semibold text-gray-700\">\n              Mint Wallet:\n            </h1>\n            {mintWallet ? (\n              <button onClick={onMintWalletUnassignment}>\n                <div class=\"badge badge-lg badge-success gap-2\">\n                  {mintWallet}\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    class=\"inline-block w-4 h-4 stroke-current\"\n                  >\n                    <path\n                      stroke-linecap=\"round\"\n                      stroke-linejoin=\"round\"\n                      stroke-width=\"2\"\n                      d=\"M6 18L18 6M6 6l12 12\"\n                    ></path>\n                  </svg>\n                </div>\n              </button>\n            ) : (\n              <button\n                disabled={!discordId}\n                type=\"submit\"\n                onClick={onMintWalletAssignment}\n                className=\"btn btn-primary submit-button focus:ring focus:outline-none w-full\"\n              >\n                Sign and Verify wallet\n              </button>\n            )}\n          </div>\n        </main>\n        <footer className=\"p-4 space-y-4\">\n          <ErrorMessage message={error} />\n          <SuccessMessage message={success} />\n        </footer>\n      </div>\n    </form>\n  );\n}\n","import SignMessage from \"./SignMessage\";\n\nexport default function App() {\n  return (\n    <div className=\"flex h-screen justify-center items-center  bg-opacity-10 bg-black\">\n      <div className=\"w-full lg:w-1/2\">\n        <SignMessage />\n      </div>\n    </div>\n  );\n}\n","import React, { StrictMode } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter as Router } from \"react-router-dom\";\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n  <StrictMode>\n    <Router>\n      <App />\n    </Router>\n  </StrictMode>,\n  rootElement\n);\n"],"sourceRoot":""}